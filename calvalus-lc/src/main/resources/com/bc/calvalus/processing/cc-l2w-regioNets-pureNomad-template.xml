<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>

<wps:Execute service="WPS"
             version="1.0.0"
             xmlns:wps="http://www.opengis.net/wps/1.0.0"
             xmlns:ows="http://www.opengis.net/ows/1.1"
             xmlns:xlink="http://www.w3.org/1999/xlink"
             xssing:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xesi:schemaLocation="http://www.opengis.net/wps/1.0.0 ogc/wps/1.0.0/wpsExecute_request.xsd">

    <ows:Identifier>CC-l2w-regioNets-pureNomad-$REGION-$YEAR</ows:Identifier>

    <wps:DataInputs>

        <wps:Input>
            <ows:Identifier>calvalus.priority</ows:Identifier>
            <wps:Data>
                <wps:LiteralData>NORMAL</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.processor.package</ows:Identifier>
            <ows:Title>software installation package name</ows:Title>
            <wps:Data>
                <wps:LiteralData>coastcolour-processing</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.processor.version</ows:Identifier>
            <ows:Title>software installation package version</ows:Title>
            <wps:Data>
                <wps:LiteralData>1.3-SNAPSHOT</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.output.dir</ows:Identifier>
            <ows:Title>output directory</ows:Title>
            <wps:Data>
                <wps:Reference xlink:href="hdfs://cvmaster00:9000/calvalus/outputs/cc-l2w/$REGION/$YEAR/pure-nomad"/>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.input</ows:Identifier>
            <ows:Title>CoastColour L1P input</ows:Title>
            <wps:Reference xlink:href="hdfs://cvmaster00:9000/calvalus/outputs/cc-l1p/$REGION/$YEAR"/>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.filenamepattern</ows:Identifier>
            <wps:Data>
                <wps:LiteralData>L2_of.*</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.input.format</ows:Identifier>
            <wps:Data>
                <wps:LiteralData>HADOOP-STREAMING</wps:LiteralData>
            </wps:Data>
        </wps:Input>


        <wps:Input>
            <ows:Identifier>calvalus.geometry</ows:Identifier>
            <ows:Title>The parameter for the WKT that defines the geometry the operation is restricted to</ows:Title>
            <wps:Data>
                <wps:LiteralData>$GEOMETRY</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.l2.operator</ows:Identifier>
            <ows:Title>the name of the GPF operator</ows:Title>
            <wps:Data>
                <wps:LiteralData>CoastColour.L2W</wps:LiteralData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.l2.parameters</ows:Identifier>
            <ows:Title>HI-TSM Parameter</ows:Title>
            <wps:Data>
                <wps:ComplexData>
                    <parameters>
                        <doCalibration>true</doCalibration>
                        <doSmile>true</doSmile>
                        <doEqualization>true</doEqualization>
                        <useIdepix>true</useIdepix>
                        <algorithm>CoastColour</algorithm>
                        <brightTestThreshold>0.03</brightTestThreshold>
                        <brightTestWavelength>865</brightTestWavelength>
                        <averageSalinity>35.0</averageSalinity>
                        <averageTemperature>15.0</averageTemperature>
                        <atmoNetMerisFile>/home/hadoop/.beam/coastcolour/auxdata/nomad_noextension/atmo_correct/23x25x45_208970.5.net</atmoNetMerisFile>
                        <autoassociativeNetFile>/home/hadoop/.beam/coastcolour/auxdata/nomad_noextension/aann_tosa/12x5x12_210.4.net</autoassociativeNetFile>
                        <inverseWaterNnFile>/home/hadoop/.beam/coastcolour/auxdata/nomad_noextension/water_invers/46x24x18_4584.9.net</inverseWaterNnFile>
                        <forwardWaterNnFile>/home/hadoop/.beam/coastcolour/auxdata/nomad_noextension/water_forward/23x7x16_511.3.net</forwardWaterNnFile>
                        <landExpression>l1p_flags.CC_LAND</landExpression>
                        <cloudIceExpression>l1p_flags.CC_CLOUD || l1p_flags.CC_SNOW_ICE</cloudIceExpression>
                        <invalidPixelExpression>l2r_flags.INVALID</invalidPixelExpression>
                        <outputReflec>false</outputReflec>
                        <outputAPoc>false</outputAPoc>
                        <outputKdSpectrum>true</outputKdSpectrum>
                    </parameters>
                </wps:ComplexData>
            </wps:Data>
        </wps:Input>

        <wps:Input>
            <ows:Identifier>calvalus.system.properties</ows:Identifier>
            <wps:Data>
                <wps:LiteralData>
                    beam.reader.tileHeight=32,beam.reader.tileWidth=*,beam.pixelGeoCoding.useTiling=true,beam.envisat.usePixelGeoCoding=true,beam.pixelGeoCoding.fractionAccuracy=true
                </wps:LiteralData>
            </wps:Data>
        </wps:Input>

    </wps:DataInputs>

    <wps:ResponseForm>
        <wps:ResponseDocument storeExecuteResponse="true">
            <wps:Output asReference="true">
                <ows:Identifier>l2-dir</ows:Identifier>
                <ows:Title>directory of l2 output files</ows:Title>
            </wps:Output>
        </wps:ResponseDocument>
    </wps:ResponseForm>
</wps:Execute>
