package com.bc.calvalus.processing.fire;

import org.apache.hadoop.fs.FileStatus;
import org.apache.hadoop.fs.Path;
import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

import static org.junit.Assert.assertEquals;

public class S2BaInputFormatTest {

    @Test
    public void testGetPeriodInputPathPattern() throws Exception {
        assertEquals("hdfs://calvalus/calvalus/projects/fire/s2-pre/.*/.*/.*/.*T30PVR.tif$", S2BaInputFormat.getPeriodInputPathPattern(
                "hdfs://calvalus/calvalus/projects/fire/s2-pre/2016/01/16/S2A_OPER_MTD_SAFL2A_PDMC_20160116T175154_R108_V20160116T105012_20160116T105012_T30PVR.tif"
        ));
    }

    @Test
    public void testGetMaxPreImagesCount_1() throws Exception {
        String[] filenames = {
                "S2A_OPER_PRD_MSIL2A_PDMC_20151209T165654_R137_V20151209T113009_20151209T113009_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20151221T111244_R137_V20151219T113012_20151219T113012_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20151229T164652_R137_V20151229T112948_20151229T112948_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160108T154129_R137_V20160108T113011_20160108T113011_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160118T165356_R137_V20160118T113008_20160118T113008_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160207T151844_R137_V20160207T112209_20160207T112209_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160217T182738_R137_V20160217T111843_20160217T111843_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160308T201807_R137_V20160308T112645_20160308T112645_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160318T201311_R137_V20160318T112145_20160318T112145_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160328T193416_R137_V20160328T112431_20160328T112431_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160407T183923_R137_V20160407T112403_20160407T112403_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160417T184653_R137_V20160417T112339_20160417T112339_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160427T183111_R137_V20160427T112711_20160427T112711_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160507T183941_R137_V20160507T111829_20160507T111829_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160527T181328_R137_V20160527T112220_20160527T112220_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160606T163854_R137_V20160606T111811_20160606T111811_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160616T181414_R137_V20160616T112217_20160616T112217_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160706T181752_R137_V20160706T112115_20160706T112115_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160716T182120_R137_V20160716T112118_20160716T112118_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160805T181813_R137_V20160805T112440_20160805T112440_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160815T181938_R137_V20160815T110652_20160815T111957_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160825T181534_R137_V20160825T110622_20160825T112644_T28PGR.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160904T181820_R137_V20160904T110652_20160904T112011_T28PGR.tif"
        };

        List<FileStatus> filteredList = new ArrayList<>();
        for (String filename : filenames) {
            filteredList.add(new FileStatus(0, false, 0, 0, 0, new Path(filename)));
        }
        assertEquals(4, S2BaInputFormat.getMaxPreImagesCount(filteredList));
    }

    @Test
    public void testGetMaxPreImagesCount_2() throws Exception {
        String[] filenames = {
                "S2A_OPER_PRD_MSIL2A_PDMC_20160807T083950_R078_V20150708T082158_20150708T082158_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160805T085416_R035_V20150913T081211_20150913T081211_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160807T020456_R035_V20150913T081211_20150913T081211_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160807T083950_R078_V20150708T082158_20150708T082158_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20151205T120053_R078_V20151205T082946_20151205T082946_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20151222T120108_R035_V20151222T082833_20151222T082833_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20151225T115351_R078_V20151225T083056_20151225T083056_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160101T115610_R035_V20160101T082628_20160101T082628_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160104T120805_R078_V20160104T083120_20160104T083120_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160111T100949_R035_V20160111T081853_20160111T081853_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160114T121047_R078_V20160114T083309_20160114T083309_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160121T115956_R035_V20160121T082704_20160121T082704_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160124T120517_R078_V20160124T082914_20160124T082914_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160213T135037_R078_V20160213T082324_20160213T082324_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160304T134755_R078_V20160304T081747_20160304T082822_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160311T114814_R035_V20160311T081424_20160311T081424_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160314T135640_R078_V20160314T082117_20160314T082117_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160321T115212_R035_V20160321T081125_20160321T081809_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160324T134536_R078_V20160324T082216_20160324T082216_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160403T115822_R078_V20160403T082619_20160403T082619_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160410T114934_R035_V20160410T081650_20160410T081650_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160413T115726_R078_V20160413T082739_20160413T082739_T36NVP.tif",
                "S2A_OPER_PRD_MSIL2A_PDMC_20160420T114818_R035_V20160420T081431_20160420T081431_T36NVP.tif"
        };

        List<FileStatus> filteredList = new ArrayList<>();
        for (String filename : filenames) {
            filteredList.add(new FileStatus(0, false, 0, 0, 0, new Path(filename)));
        }
        assertEquals(8, S2BaInputFormat.getMaxPreImagesCount(filteredList));
    }
}