Preparation
-----------
Before restarting the portal server and/or deploying new software it should should be ensured
that there is no running job started by a user from one of the portals (default/cc). Unfortunately
there is no better way as to look closely at the running jobs in the Hadoop administration interface.

Building
--------
mvn clean package
or faster:
mvn clean package --offline -DskipTests=true

===========================================================================
Software archive
----------------
mkdir calvalus-software

cp calvalus-distribution/src/main/resources/INSTALL.txt     calvalus-software/
cp calvalus-distribution/src/main/resources/calvalus.config calvalus-software/
cp calvalus-distribution/target/calvalus-bundle/            calvalus-software/
cp calvalus-distribution/target/beam-bundle/                calvalus-software/
cp calvalus-distribution/target/cpt.jar                     calvalus-software/
tar czf calvalus-software.tar.gz  calvalus-software


Source archive
---------------
cd ..
tar cvzf calvalus-src-$(date +%Y-%m-%d).tgz  --exclude .git --exclude target calvalus
===========================================================================
Calvalus
--------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall calvalus-2.7
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-2.7

for lc-cci
----------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall  calvalus-2.4-lc
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-2.4-lc

BEAM
-----
java -jar calvalus-distribution/target/cpt.jar -e --uninstall beam-5.0.1
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/beam-bundle/*.jar beam-5.0.1

for diversity
-------------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall calvalus-2.4-diversity
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-2.4-diversity


Personal debugging
------------------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall calvalus-SNAPSHOT-mz
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-SNAPSHOT-mz

java -jar calvalus-distribution/target/cpt.jar -e --uninstall beam-SNAPSHOT-mz
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/beam-bundle/*.jar beam-SNAPSHOT-mz


java -jar calvalus-distribution/target/cpt.jar -e --calvalus calvalus-SNAPSHOT-mz --beam beam-SNAPSHOT-mz test.xml


pfa-fex
-------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall calvalus-2.4-fex
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-2.4-fex

java -jar calvalus-distribution/target/cpt.jar -e --uninstall pfa-0.1-SNAPSHOT
java -jar calvalus-distribution/target/cpt.jar -e --deploy /home/marcoz/Workspace/pfa/bundle/*.jar pfa-0.1-SNAPSHOT

java -jar calvalus-distribution/target/cpt.jar -e --calvalus calvalus-2.4-fex /home/marcoz/Workspace/pfa/fex.xml

===========================================================================
Portal Software
-------------------
java -jar calvalus-distribution/target/cpt.jar -e --uninstall calvalus-2.7
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/calvalus-bundle/*.jar calvalus-2.7
java -jar calvalus-distribution/target/cpt.jar -e --uninstall beam-5.0.1
java -jar calvalus-distribution/target/cpt.jar -e --deploy  calvalus-distribution/target/beam-bundle/*.jar beam-5.0.1

WAR (for the portal)
--------------------
(cd calvalus-portal/target; scp calvalus-portal.war cvop@bcvm03: )
ssh cvop@bcvm03
cd /opt/apache-tomcat-7.0.53/
#./bin/shutdown.sh

# save staging
mv webapps/calvalus/staging temp/

# redeploy
rm -rf webapps/calvalus webapps/calvalus.war
rm -rf work/Catalina/localhost/calvalus/
mv /home/cvop/calvalus-portal.war webapps/calvalus.war

# restart
#./bin/startup.sh
tail -5f logs/catalina.out

# restore staging
rm -rf webapps/calvalus/staging/
mv temp/staging webapps/calvalus/

===========================================================================
CC Portal Software
-------------------

(cd calvalus-portal/target; scp -r calvalus-portal.war www/cc-patch cvop@bcvm03: )

ssh cvop@bcvm03
cd /opt/apache-tomcat-7.0.53

# save staging
# sudo umount /opt/apache-tomcat-7.0.53/webapps/ccprocessing/staging
mv webapps/ccprocessing/staging temp/


# redeploy
rm -r webapps/ccprocessing.war webapps/ccprocessing
mv /home/cvop/calvalus-portal.war webapps/ccprocessing.war
tail -5f logs/catalina.out
cp -r /home/cvop/cc-patch/* webapps/ccprocessing

# restore staging
# sudo mount /opt/apache-tomcat-7.0.53/webapps/ccprocessing/staging
rm -rf webapps/ccprocessing/staging/
mv temp/staging webapps/ccprocessing/


